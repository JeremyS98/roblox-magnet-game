-- ServerScriptService/Modules/XPAdjust.lua
-- Central place to modify XP gains.
-- Doubles XP for Admins and for holders of the Double XP gamepass.

local ServerScriptService = game:GetService("ServerScriptService")

local Admins
do
	local ok, mod = pcall(function()
		return require(ServerScriptService:WaitForChild("Modules"):WaitForChild("Admins"))
	end)
	if ok then Admins = mod else warn("[XPAdjust] Admins module missing or failed to load:", mod) end
end

local GamepassService
do
	local ok, mod = pcall(function()
		return require(ServerScriptService:WaitForChild("Modules"):WaitForChild("GamepassService"))
	end)
	if ok then GamepassService = mod else warn("[XPAdjust] GamepassService module missing or failed to load:", mod) end
end

local M = {}

-- Returns a possibly modified XP amount (integer >= 0)
function M.Adjust(player, amount)
	amount = math.max(0, math.floor(tonumber(amount) or 0))
	if amount == 0 then return 0 end

	local uid = player and player.UserId
	local mult = 1.0

	-- Admins always get double (for testing)
	if Admins and Admins.IsAdmin and uid and Admins.IsAdmin(uid) then
		mult = math.max(mult, 2.0)
	end

	-- Double XP gamepass
	if GamepassService and GamepassService.HasDoubleXP and uid then
		local ok, has = pcall(function() return GamepassService.HasDoubleXP(uid) end)
		if ok and has == true then
			mult = math.max(mult, 2.0)
		end
	end

	local out = math.floor(amount * mult + 0.0001)
	return out
end

return M
